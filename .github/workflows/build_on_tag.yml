name: Build with version from tag

on:
  create:
    tags:
      - '*'
      
jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Setup .NET
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: '8.0.x'  # Adjust the version if needed

    - name: Get the version from tag
      id: get_version
      run: echo ::set-output name=VERSION::${GITHUB_REF#refs/tags/}

    - name: set version in assembly
        id: set-assembly-version
        uses: secondbounce/assemblyinfo-update@v2
        with:
          version: '{{steps.get_version.outputs.VERSION}}'
          directory: '.\'
          filename: 'FlightRecorder.csproj'
          recursive: false

    - name: Build the project
      run: dotnet build --configuration Release

    - name: Publish the project
      run: dotnet publish --configuration Release --output publish_output

    - name: Upload zip artifact
      uses: actions/upload-artifact@v2
      with:
        name: flight_recorder{{steps.get_version.outputs.VERSION}}
        path: publish_output/*
